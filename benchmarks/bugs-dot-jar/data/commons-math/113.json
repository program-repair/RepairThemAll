{
    "bug_id": 113,
    "classification": {
        "singleLine": false
    },
    "commit": "9c8bb934",
    "failing_tests": [
        "org.apache.commons.math.random.Well512aTest",
        "org.apache.commons.math.random.Well1024aTest",
        "org.apache.commons.math.random.RandomDataTest",
        "org.apache.commons.math.random.Well44497bTest",
        "org.apache.commons.math.random.MersenneTwisterTest",
        "org.apache.commons.math.random.ISAACTest",
        "org.apache.commons.math.random.BitsStreamGeneratorTest",
        "org.apache.commons.math.random.AbstractRandomGeneratorTest",
        "org.apache.commons.math.random.Well44497aTest",
        "org.apache.commons.math.random.Well19937aTest"
    ],
    "files": 2,
    "jira_id": "724",
    "linesAdd": 30,
    "linesRem": 14,
    "nb_error": 0,
    "nb_failure": 70,
    "nb_skipped": 1,
    "nb_test": 3326,
    "patch": "diff --git a/src/main/java/org/apache/commons/math/exception/util/LocalizedFormats.java b/src/main/java/org/apache/commons/math/exception/util/LocalizedFormats.java\nindex cfec8ca1e..c5c14a96c 100644\n--- a/src/main/java/org/apache/commons/math/exception/util/LocalizedFormats.java\n+++ b/src/main/java/org/apache/commons/math/exception/util/LocalizedFormats.java\n@@ -116,6 +116,7 @@\n     INDEX_OUT_OF_RANGE(\"index {0} out of allowed range [{1}, {2}]\"),\n     INDEX(\"index ({0})\"), /* keep */\n     NOT_FINITE_NUMBER(\"{0} is not a finite number\"), /* keep */\n+    INFINITE_BOUND(\"interval bounds must be finite\"),\n     ARRAY_ELEMENT(\"value {0} at index {1}\"), /* keep */\n     INFINITE_ARRAY_ELEMENT(\"Array contains an infinite element, {0} at index {1}\"),\n     INFINITE_VALUE_CONVERSION(\"cannot convert infinite value\"),\n@@ -240,6 +241,7 @@\n     NO_REGRESSORS(\"Regression model must include at least one regressor\"),\n     NO_RESULT_AVAILABLE(\"no result available\"),\n     NO_SUCH_MATRIX_ENTRY(\"no entry at indices ({0}, {1}) in a {2}x{3} matrix\"),\n+    NAN_NOT_ALLOWED(\"NaN is not allowed\"),\n     NULL_NOT_ALLOWED(\"null is not allowed\"), /* keep */\n     ARRAY_ZERO_LENGTH_OR_NULL_NOTALLOWED(\"A null or zero length array not allowed\"),\n     COVARIANCE_MATRIX(\"covariance matrix\"), /* keep */\ndiff --git a/src/main/java/org/apache/commons/math/random/RandomDataImpl.java b/src/main/java/org/apache/commons/math/random/RandomDataImpl.java\nindex 0fda68822..16d655bb8 100644\n--- a/src/main/java/org/apache/commons/math/random/RandomDataImpl.java\n+++ b/src/main/java/org/apache/commons/math/random/RandomDataImpl.java\n@@ -36,6 +36,7 @@\n import org.apache.commons.math.distribution.TDistribution;\n import org.apache.commons.math.distribution.WeibullDistribution;\n import org.apache.commons.math.distribution.ZipfDistribution;\n+import org.apache.commons.math.exception.MathIllegalArgumentException;\n import org.apache.commons.math.exception.MathInternalError;\n import org.apache.commons.math.exception.NotStrictlyPositiveException;\n import org.apache.commons.math.exception.NumberIsTooLargeException;\n@@ -250,7 +251,8 @@ public int nextInt(int lower, int upper) {\n                                                 lower, upper, false);\n         }\n         double r = getRan().nextDouble();\n-        return (int) ((r * upper) + ((1.0 - r) * lower) + r);\n+        double scaled = r * upper + (1.0 - r) * lower + r;\n+        return (int)FastMath.floor(scaled);\n     }\n \n     /**\n@@ -270,7 +272,8 @@ public long nextLong(long lower, long upper) {\n                                                 lower, upper, false);\n         }\n         double r = getRan().nextDouble();\n-        return (long) ((r * upper) + ((1.0 - r) * lower) + r);\n+        double scaled = r * upper + (1.0 - r) * lower + r;\n+        return (long)FastMath.floor(scaled);\n     }\n \n     /**\n@@ -361,7 +364,9 @@ public int nextSecureInt(int lower, int upper) {\n                                                 lower, upper, false);\n         }\n         SecureRandom sec = getSecRan();\n-        return lower + (int) (sec.nextDouble() * (upper - lower + 1));\n+        double r = sec.nextDouble();\n+        double scaled = r * upper + (1.0 - r) * lower + r;\n+        return (int)FastMath.floor(scaled);\n     }\n \n     /**\n@@ -382,7 +387,9 @@ public long nextSecureLong(long lower, long upper) {\n                                                 lower, upper, false);\n         }\n         SecureRandom sec = getSecRan();\n-        return lower + (long) (sec.nextDouble() * (upper - lower + 1));\n+        double r = sec.nextDouble();\n+        double scaled = r * upper + (1.0 - r) * lower + r;\n+        return (long)FastMath.floor(scaled);\n     }\n \n     /**\n@@ -579,19 +586,26 @@ public double nextExponential(double mean) {\n      * provide a symmetric output interval (both endpoints excluded).\n      * </p>\n      *\n-     * @param lower\n-     *            the lower bound.\n-     * @param upper\n-     *            the upper bound.\n-     * @return a uniformly distributed random value from the interval (lower,\n-     *         upper)\n-     * @throws NumberIsTooLargeException if {@code lower >= upper}.\n+     * @param lower the lower bound.\n+     * @param upper the upper bound.\n+     * @return a uniformly distributed random value from the interval (lower, upper)\n+     * @throws MathIllegalArgumentException if {@code lower >= upper}\n+     * or either bound is infinite or NaN\n      */\n     public double nextUniform(double lower, double upper) {\n         if (lower >= upper) {\n-            throw new NumberIsTooLargeException(LocalizedFormats.LOWER_BOUND_NOT_BELOW_UPPER_BOUND,\n-                                                lower, upper, false);\n+            throw new MathIllegalArgumentException(LocalizedFormats.LOWER_BOUND_NOT_BELOW_UPPER_BOUND,\n+                                                lower, upper);\n+        }\n+\n+        if (Double.isInfinite(lower) || Double.isInfinite(upper)) {\n+            throw new MathIllegalArgumentException(LocalizedFormats.INFINITE_BOUND);\n         }\n+\n+        if (Double.isNaN(lower) || Double.isNaN(upper)) {\n+            throw new MathIllegalArgumentException(LocalizedFormats.NAN_NOT_ALLOWED);\n+        }\n+\n         final RandomGenerator generator = getRan();\n \n         // ensure nextDouble() isn't 0.0\n@@ -600,7 +614,7 @@ public double nextUniform(double lower, double upper) {\n             u = generator.nextDouble();\n         }\n \n-        return lower + u * (upper - lower);\n+        return u * upper + (1.0 - u) * lower;\n     }\n \n     /**\n",
    "project": "commons-math",
    "buggy_compile_success": true,
    "buggy_test_success": false,
    "fixed_compile_success": true,
    "fixed_test_success": false
}