{
    "bug_id": 3,
    "classification": {
        "singleLine": false
    },
    "commit": "5d99b35c",
    "failing_tests": [
        "org.apache.maven.project.artifact.MavenMetadataSourceTest"
    ],
    "files": 2,
    "jira_id": "1797",
    "linesAdd": 30,
    "linesRem": 11,
    "nb_error": 0,
    "nb_failure": 1,
    "nb_skipped": 0,
    "nb_test": 106,
    "patch": "diff --git a/maven-project/src/main/java/org/apache/maven/profiles/DefaultProfileManager.java b/maven-project/src/main/java/org/apache/maven/profiles/DefaultProfileManager.java\nindex 5f6534d85..68acd290b 100644\n--- a/maven-project/src/main/java/org/apache/maven/profiles/DefaultProfileManager.java\n+++ b/maven-project/src/main/java/org/apache/maven/profiles/DefaultProfileManager.java\n@@ -66,13 +66,14 @@ public DefaultProfileManager( PlexusContainer container )\n      */\n     public DefaultProfileManager( PlexusContainer container, Properties props )\n     {\n-        this( container, (Settings)null );\n-        if (props != null) {\n-            systemProperties = props;\n-        }\n+        this( container, (Settings)null, props );\n         \n     }\n \n+    /**\n+     * @deprecated without passing in the system properties, the SystemPropertiesProfileActivator will not work correctly\n+     * in embedded envirnments.\n+     */\n     public DefaultProfileManager( PlexusContainer container, Settings settings )\n     {\n         this.container = container;\n@@ -80,6 +81,23 @@ public DefaultProfileManager( PlexusContainer container, Settings settings )\n         loadSettingsProfiles( settings );\n     }\n     \n+    /**\n+     * the properties passed to the profile manager are the props that\n+     * are passed to maven, possibly containing profile activator properties\n+     *\n+     */\n+    public DefaultProfileManager( PlexusContainer container, Settings settings, Properties props )\n+    {\n+        this.container = container;\n+\n+        loadSettingsProfiles( settings );\n+        \n+        if ( props != null )\n+        {\n+            systemProperties = props;\n+        }\n+    }\n+    \n     public Properties getSystemProperties() {\n         return systemProperties;\n     }\ndiff --git a/maven-project/src/main/java/org/apache/maven/project/artifact/MavenMetadataSource.java b/maven-project/src/main/java/org/apache/maven/project/artifact/MavenMetadataSource.java\nindex ffa3ac6fa..bde81f380 100644\n--- a/maven-project/src/main/java/org/apache/maven/project/artifact/MavenMetadataSource.java\n+++ b/maven-project/src/main/java/org/apache/maven/project/artifact/MavenMetadataSource.java\n@@ -48,7 +48,6 @@\n import java.io.File;\n import java.util.ArrayList;\n import java.util.Collections;\n-import java.util.HashSet;\n import java.util.Iterator;\n import java.util.LinkedHashSet;\n import java.util.List;\n@@ -337,7 +336,9 @@ public static Set createArtifacts( ArtifactFactory artifactFactory, List depende\n                 artifact.setFile( new File( d.getSystemPath() ) );\n             }\n \n-            if ( artifact != null && ( dependencyFilter == null || dependencyFilter.include( artifact ) ) )\n+            ArtifactFilter artifactFilter = dependencyFilter;\n+            \n+            if ( artifact != null && ( artifactFilter == null || artifactFilter.include( artifact ) ) )\n             {\n                 if ( d.getExclusions() != null && !d.getExclusions().isEmpty() )\n                 {\n@@ -350,20 +351,20 @@ public static Set createArtifacts( ArtifactFactory artifactFactory, List depende\n \n                     ArtifactFilter newFilter = new ExcludesArtifactFilter( exclusions );\n \n-                    if ( dependencyFilter != null )\n+                    if ( artifactFilter != null )\n                     {\n                         AndArtifactFilter filter = new AndArtifactFilter();\n-                        filter.add( dependencyFilter );\n+                        filter.add( artifactFilter );\n                         filter.add( newFilter );\n-                        dependencyFilter = filter;\n+                        artifactFilter = filter;\n                     }\n                     else\n                     {\n-                        dependencyFilter = newFilter;\n+                        artifactFilter = newFilter;\n                     }\n                 }\n \n-                artifact.setDependencyFilter( dependencyFilter );\n+                artifact.setDependencyFilter( artifactFilter );\n \n                 if ( project != null )\n                 {\n",
    "project": "maven"
}