{
    "bug_id": 23,
    "classification": {
        "singleLine": false
    },
    "commit": "c6529932",
    "failing_tests": [
        "org.apache.maven.model.building.ComplexActivationTest"
    ],
    "files": 6,
    "jira_id": "4565",
    "linesAdd": 98,
    "linesRem": 3,
    "nb_error": 0,
    "nb_failure": 1,
    "nb_skipped": 0,
    "nb_test": 96,
    "patch": "diff --git a/maven-model-builder/src/main/java/org/apache/maven/model/profile/DefaultProfileSelector.java b/maven-model-builder/src/main/java/org/apache/maven/model/profile/DefaultProfileSelector.java\nindex c376c999e..0aeed9d1e 100644\n--- a/maven-model-builder/src/main/java/org/apache/maven/model/profile/DefaultProfileSelector.java\n+++ b/maven-model-builder/src/main/java/org/apache/maven/model/profile/DefaultProfileSelector.java\n@@ -104,13 +104,19 @@ else if ( isActiveByDefault( profile ) )\n \n     private boolean isActive( Profile profile, ProfileActivationContext context, ModelProblemCollector problems )\n     {\n+        boolean isActive = false;\n+        for ( ProfileActivator activator : activators ) {\n+            if ( activator.presentInConfig( profile, context, problems ) ) {\n+                isActive = true;\n+            }\n+        }\n         for ( ProfileActivator activator : activators )\n         {\n             try\n             {\n-                if ( activator.isActive( profile, context, problems ) )\n+                if ( activator.presentInConfig( profile, context, problems ) )\n                 {\n-                    return true;\n+                    isActive &=  activator.isActive( profile, context, problems );\n                 }\n             }\n             catch ( RuntimeException e )\n@@ -122,7 +128,7 @@ private boolean isActive( Profile profile, ProfileActivationContext context, Mod\n                 return false;\n             }\n         }\n-        return false;\n+        return isActive;\n     }\n \n     private boolean isActiveByDefault( Profile profile )\ndiff --git a/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/FileProfileActivator.java b/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/FileProfileActivator.java\nindex 07ba79b4a..b1d04427a 100644\n--- a/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/FileProfileActivator.java\n+++ b/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/FileProfileActivator.java\n@@ -167,4 +167,23 @@ else if ( path.contains( \"${basedir}\" ) )\n         return missing ? !fileExists : fileExists;\n     }\n \n+    @Override\n+    public boolean presentInConfig( Profile profile, ProfileActivationContext context, ModelProblemCollector problems )\n+    {\n+        Activation activation = profile.getActivation();\n+\n+        if ( activation == null )\n+        {\n+            return false;\n+        }\n+\n+        ActivationFile file = activation.getFile();\n+\n+        if ( file == null )\n+        {\n+            return false;\n+        }\n+        return true;\n+    }\n+\n }\ndiff --git a/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/JdkVersionProfileActivator.java b/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/JdkVersionProfileActivator.java\nindex 62b6cfb7b..10747de6b 100644\n--- a/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/JdkVersionProfileActivator.java\n+++ b/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/JdkVersionProfileActivator.java\n@@ -83,6 +83,25 @@ else if ( isRange( jdk ) )\n         }\n     }\n \n+    @Override\n+    public boolean presentInConfig( Profile profile, ProfileActivationContext context, ModelProblemCollector problems )\n+    {\n+        Activation activation = profile.getActivation();\n+\n+        if ( activation == null )\n+        {\n+            return false;\n+        }\n+\n+        String jdk = activation.getJdk();\n+\n+        if ( jdk == null )\n+        {\n+            return false;\n+        }\n+        return true;\n+    }\n+\n     private static boolean isInRange( String value, List<RangeValue> range )\n     {\n         int leftRelation = getRelationOrder( value, range.get( 0 ), true );\ndiff --git a/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/OperatingSystemProfileActivator.java b/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/OperatingSystemProfileActivator.java\nindex 94d380cd1..b6d3f052b 100644\n--- a/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/OperatingSystemProfileActivator.java\n+++ b/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/OperatingSystemProfileActivator.java\n@@ -76,6 +76,25 @@ public boolean isActive( Profile profile, ProfileActivationContext context, Mode\n         return active;\n     }\n \n+    @Override\n+    public boolean presentInConfig( Profile profile, ProfileActivationContext context, ModelProblemCollector problems )\n+    {\n+        Activation activation = profile.getActivation();\n+\n+        if ( activation == null )\n+        {\n+            return false;\n+        }\n+\n+        ActivationOS os = activation.getOs();\n+\n+        if ( os == null )\n+        {\n+            return false;\n+        }\n+        return true;\n+    }\n+\n     private boolean ensureAtLeastOneNonNull( ActivationOS os )\n     {\n         return os.getArch() != null || os.getFamily() != null || os.getName() != null || os.getVersion() != null;\ndiff --git a/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/ProfileActivator.java b/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/ProfileActivator.java\nindex 142dddf6b..7094a3f86 100644\n--- a/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/ProfileActivator.java\n+++ b/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/ProfileActivator.java\n@@ -43,4 +43,17 @@\n      */\n     boolean isActive( Profile profile, ProfileActivationContext context, ModelProblemCollector problems );\n \n+    /**\n+     * Determines whether specified activation method is present in configuration or not. It should help to have AND between\n+     * activation conditions\n+     * Need for solving http://jira.codehaus.org/browse/MNG-4565\n+     * @param profile The profile whose activation status should be determined, must not be {@code null}.\n+     * @param context The environmental context used to determine the activation status of the profile, must not be\n+     *            {@code null}.\n+     * @param problems The container used to collect problems (e.g. bad syntax) that were encountered, must not be\n+     *            {@code null}.\n+     * @return {@code true} if the profile is active, {@code false} otherwise.\n+     */\n+    boolean presentInConfig( Profile profile, ProfileActivationContext context, ModelProblemCollector problems );\n+\n }\ndiff --git a/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/PropertyProfileActivator.java b/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/PropertyProfileActivator.java\nindex 374647fd2..e8e6e998e 100644\n--- a/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/PropertyProfileActivator.java\n+++ b/maven-model-builder/src/main/java/org/apache/maven/model/profile/activation/PropertyProfileActivator.java\n@@ -103,4 +103,23 @@ public boolean isActive( Profile profile, ProfileActivationContext context, Mode\n         }\n     }\n \n+    @Override\n+    public boolean presentInConfig( Profile profile, ProfileActivationContext context, ModelProblemCollector problems )\n+    {\n+        Activation activation = profile.getActivation();\n+\n+        if ( activation == null )\n+        {\n+            return false;\n+        }\n+\n+        ActivationProperty property = activation.getProperty();\n+\n+        if ( property == null )\n+        {\n+            return false;\n+        }\n+        return true;\n+    }\n+\n }\n",
    "project": "maven"
}